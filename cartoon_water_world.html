<!DOCTYPE html> <!-- HTML5æ–‡æ¡£ç±»å‹å£°æ˜ - å‘Šè¯‰æµè§ˆå™¨è¿™æ˜¯ç°ä»£HTML -->
<html lang="zh-CN"> <!-- HTMLæ ¹å…ƒç´ å¼€å§‹ï¼Œlang="zh-CN"è®¾ç½®é¡µé¢è¯­è¨€ä¸ºç®€ä½“ä¸­æ–‡ -->

<head>
    <meta charset="UTF-8"> <!-- è®¾ç½®å­—ç¬¦ç¼–ç ä¸ºUTF-8ï¼Œæ”¯æŒä¸­æ–‡å’Œå„ç§ç‰¹æ®Šå­—ç¬¦ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- ç§»åŠ¨ç«¯é€‚é… - è®©é¡µé¢åœ¨æ‰‹æœºä¸Šæ­£å¸¸æ˜¾ç¤º -->
    <title>ğŸ¨ å¡é€šæ°´é¢ä¸–ç•Œ</title> <!-- æµè§ˆå™¨æ ‡ç­¾é¡µæ˜¾ç¤ºçš„æ ‡é¢˜ -->
    <!-- CSSæ ·å¼å¼€å§‹ - å®šä¹‰é¡µé¢çš„å¤–è§‚å’Œå¸ƒå±€ -->
    <style>
        /* =================== ğŸ¨ å¡é€šé£æ ¼CSS =================== */
        /* CSSé‡ç½® - æ¶ˆé™¤æµè§ˆå™¨é»˜è®¤æ ·å¼å·®å¼‚ */
        * {
            margin: 0;
            /* å¤–è¾¹è·è®¾ä¸º0 - æ¶ˆé™¤å…ƒç´ é—´çš„é»˜è®¤é—´è· */
            padding: 0;
            /* å†…è¾¹è·è®¾ä¸º0 - æ¶ˆé™¤å…ƒç´ å†…çš„é»˜è®¤é—´è· */
            box-sizing: border-box;
            /* è¾¹æ¡†ç›’æ¨¡å‹ - widthåŒ…å«paddingå’Œborder */
        }

        /* bodyå…ƒç´ æ ·å¼ - å®šä¹‰æ•´ä¸ªé¡µé¢çš„åŸºç¡€å¤–è§‚ */
        body {
            /* èƒŒæ™¯æ¸å˜ - ä»å·¦ä¸Šåˆ°å³ä¸‹çš„æ¸å˜è‰² */
            background: linear-gradient(135deg, #87a0c0 0%, #15263f 100%);
            /* 135åº¦è§’æ¸å˜ */
            font-family: 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            /* å­—ä½“æ— - ä¼˜å…ˆä½¿ç”¨å¾®è½¯é›…é»‘ï¼Œå¤‡é€‰Arial */
            overflow: hidden;
            /* éšè—æ»šåŠ¨æ¡ - åˆ›é€ å…¨å±3Dä½“éªŒ */
        }

        /* WebGLç”»å¸ƒæ ·å¼ - è¿™æ˜¯3Då›¾å½¢çš„æ¸²æŸ“ç›®æ ‡ */
        #canvas {
            display: block;
            /* å—çº§å…ƒç´  - ç‹¬å ä¸€è¡Œ */
            width: 100vw;
            /* å®½åº¦100%è§†å£å®½åº¦ - å…¨å±å®½åº¦ */
            height: 100vh;
            /* é«˜åº¦100%è§†å£é«˜åº¦ - å…¨å±é«˜åº¦ */
            cursor: grab;
            /* é¼ æ ‡æ ·å¼ - æ˜¾ç¤ºå¯æŠ“å–çš„æ‰‹å‹ */
        }

        /* é¼ æ ‡æŒ‰ä¸‹æ—¶çš„æ ·å¼ - ä¼ªç±»é€‰æ‹©å™¨ */
        #canvas:active {
            cursor: grabbing;
            /* é¼ æ ‡æŒ‰ä¸‹æ—¶æ˜¾ç¤ºæŠ“å–ä¸­çš„æ‰‹å‹ */
        }

        /* =================== æ§åˆ¶é¢æ¿ï¼ˆå³ä¸‹è§’è¯´æ˜ï¼‰ =================== */
        /* ç”¨äºå³ä¸‹è§’çš„"é¼ æ ‡æ§åˆ¶è¯´æ˜"é¢æ¿ */
        .controls-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(-90deg, #60a4fd91 0%, #dd8fff42 100%);
            color: rgb(23, 39, 54);
            padding: 15px;
            border-radius: 15px;
            font-size: 13px;
            border: 2px solid #1e6296;
        }

        /* =================== åŠ è½½è¿›åº¦æ¡ç›¸å…³ =================== */
        /* è¿›åº¦æ¡å®¹å™¨ï¼Œå±…ä¸­æ˜¾ç¤º */
        .progress-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 2000;
        }

        /* è¿›åº¦æ¡ä¸Šçš„æ–‡å­— */
        .progress-text {
            color: #2d3436;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
        }

        /* è¿›åº¦æ¡æœ¬ä½“ */
        .progress-bar {
            width: 300px;
            height: 12px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 6px;
            overflow: hidden;
            border: 2px solid #fd79a8;
        }

        /* è¿›åº¦æ¡å¡«å……éƒ¨åˆ† */
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fd79a8, #fdcb6e);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        @media (max-width: 600px) {
            .settings-panel {
                /* æ•´ä½“ç­‰æ¯”ä¾‹ç¼©å°åˆ°80% */
                transform: scale(0.45);
                transform-origin: top left;
                left: 0;
                top: 0;
                width: 320px;
                /* å’ŒPCç«¯ä¸€è‡´ */
                max-width: none;
                min-width: 0;
                /* å…¶å®ƒPCç«¯æ ·å¼ä¸ç”¨å†é‡å¤ */
            }

            /* ä¸éœ€è¦å†å•ç‹¬è®¾ç½®å­—ä½“ã€inputå®½é«˜ç­‰ */
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body>
    <!-- =================== è®¾ç½®é¢æ¿ =================== -->
    <div class="settings-panel" style="position:fixed;top:20px;left:20px;background:linear-gradient(180deg,#2935a588 0%,#28679e86 100%);
        color:#2d3436;padding:25px;border-radius:20px;max-width:350px;box-shadow:0 8px 24px rgba(0,0,0,0.08);
        border:2px solid #7ea6e0;z-index:1000;">
        <h2 style="color:#252e53;margin-bottom:18px;font-size:20px;">âš™ï¸ åœºæ™¯è®¾ç½®</h2>

        <!-- ===== å¤©ç©ºé¢œè‰²åˆ†ç»„ï¼ˆfieldsetåŒ…å›´ï¼Œä¸¤ä¸ªæ‹¾è‰²å™¨å¹¶æ’ï¼‰ ===== -->
        <fieldset style="border:1.5px solid #8fc4f7;border-radius:8px;padding:10px 12px 8px 12px;margin-bottom:18px;">
            <legend style="font-weight:bold;color:#8fc4f7;padding:0 8px;">ğŸŒŒ å¤©ç©º</legend>
            <!-- ç”¨flexè®©ä¸¤ä¸ªæ‹¾è‰²å™¨å±…ä¸­ä¸”é—´è·é€‚ä¸­ -->
            <div style="display: flex; justify-content: center; align-items: center; gap: 24px;">
                <!-- å¤©ç©ºä¸­é—´é¢œè‰²æ‹¾è‰²å™¨ -->
                <input type="color" id="middleColorPicker" value="#3789E1"
                    style="width:36px;height:36px;border:none;background:none;cursor:pointer;">
                <!-- å¤©ç©ºåº•éƒ¨é¢œè‰²æ‹¾è‰²å™¨ -->
                <input type="color" id="bottomColorPicker" value="#ABDEF7"
                    style="width:36px;height:36px;border:none;background:none;cursor:pointer;">
            </div>
        </fieldset>

        <!-- ===== é˜³å…‰é¢œè‰²è®¾ç½®ï¼ˆåˆ†ç»„ï¼‰ ===== -->
        <fieldset style="border:1.5px solid #f7c873;border-radius:8px;padding:10px 12px 8px 12px;margin-bottom:18px;">
            <legend style="font-weight:bold;color:#f7c873;padding:0 8px;">â˜€ï¸ é˜³å…‰</legend>
            <input type="color" id="sunColorPicker" value="#FFE4B5"
                style="vertical-align:middle;width:36px;height:36px;border:none;background:none;cursor:pointer;">
        </fieldset>

        <!-- ========== â˜€ï¸ é˜³å…‰æ–¹å‘æ§åˆ¶ ========== -->
        <!-- è¯´æ˜ï¼šé€šè¿‡ä¸¤ä¸ªè§’åº¦æ»‘å—å®æ—¶è°ƒæ•´ä¸»å…‰ï¼ˆDirectionalLightï¼‰æ–¹å‘ -->
        <div style="margin-top:10px;">
            <label>
                <span style="font-weight:bold;color:#f7c873;margin-right:8px;">é˜³å…‰Xè½´è§’åº¦</span>
                <input type="range" id="sunDirXSlider" min="-90" max="90" step="1" value="45" style="vertical-align:middle;width:120px;">
                <span id="sunDirXValue">45</span>Â°
            </label>
        </div>
        <div style="margin-top:6px;">
            <label>
                <span style="font-weight:bold;color:#f7c873;margin-right:8px;">é˜³å…‰Zè½´è§’åº¦</span>
                <input type="range" id="sunDirZSlider" min="-180" max="180" step="1" value="45" style="vertical-align:middle;width:120px;">
                <span id="sunDirZValue">45</span>Â°
            </label>
        </div>

        <!-- ===== æ°´é¢æ³•çº¿è´´å›¾å‚æ•°åˆ†ç»„ ===== -->
        <fieldset style="border:1.5px solid #4ecdc4;border-radius:8px;padding:10px 12px 8px 12px;margin-bottom:18px;">
            <legend style="font-weight:bold;color:#4ecdc4;padding:0 8px;">ğŸŒŠ æ°´é¢æ³•çº¿</legend>
            <div style="margin-bottom:10px;">
                <label>
                    <span style="font-weight:bold;color:#2d3436;margin-right:8px;">çº¹ç†ç¼©æ”¾</span>
                    <input type="range" id="waterRepeatSlider" min="1" max="8" step="0.1" value="3"
                        style="vertical-align:middle;width:120px;">
                </label>
            </div>
            <div>
                <label>
                    <span style="font-weight:bold;color:#2d3436;margin-right:8px;">é€Ÿåº¦</span>
                    <input type="range" id="waterSpeedSlider" min="0.01" max="0.2" step="0.01" value="0.06"
                        style="vertical-align:middle;width:120px;">
                </label>
            </div>
        </fieldset>

        <!-- ===== é˜´å½±æ»‘æ†è®¾ç½® å•ç‹¬ä¸€è¡Œï¼‰===== -->
        <div style="margin-top:12px;">
            <label>
                <span style="font-weight:bold;color:#252e53;margin-right:8px;">é˜´å½±</span>
                <input type="range" id="shadowSlider" min="0" max="1" step="0.01" value="0.6"
                    style="vertical-align:middle;width:120px;">
            </label>
        </div>

        <!-- ===== æ˜æš—æ»‘æ†è®¾ç½®ï¼ˆå•ç‹¬ä¸€è¡Œï¼‰===== -->
        <div style="margin-top:12px;">
            <label>
                <span style="font-weight:bold;color:#252e53;margin-right:8px;">æ˜æš—</span>
                <input type="range" id="brightnessSlider" min="0.01" max="1" step="0.01" value="0.7"
                    style="vertical-align:middle;width:120px;">
            </label>
        </div>

        <!-- é«˜å…‰é˜ˆå€¼æ§åˆ¶æ»‘å— -->
        <label for="waterSpecularThresholdSlider">é«˜å…‰é˜ˆå€¼</label>
        <input id="waterSpecularThresholdSlider" type="range" min="0.8" max="1.0" step="0.001" value="0.985">
        <span id="waterSpecularThresholdValue">0.985</span>
        <br>

        <!-- é«˜å…‰å¼ºåº¦æ§åˆ¶æ»‘å— -->
        <label for="waterSpecularStrengthSlider">é«˜å…‰å¼ºåº¦</label>
        <input id="waterSpecularStrengthSlider" type="range" min="0.0" max="1.0" step="0.01" value="0.18">
        <span id="waterSpecularStrengthValue">0.18</span>
        <br>

        <!-- è²å°¼å°”Poweræ§åˆ¶æ»‘å— -->
        <label for="waterFresnelPowerSlider">è²å°¼å°”Power</label>
        <input id="waterFresnelPowerSlider" type="range" min="1.0" max="5.0" step="0.01" value="3.0">
        <span id="waterFresnelPowerValue">3.0</span>
        <br>

        <!-- è²å°¼å°”å¼ºåº¦æ§åˆ¶æ»‘å— -->
        <label for="waterFresnelStrengthSlider">è²å°¼å°”å¼ºåº¦</label>
        <input id="waterFresnelStrengthSlider" type="range" min="0.0" max="1.0" step="0.01" value="0.18">
        <span id="waterFresnelStrengthValue">0.18</span>
        <br>

    </div>

    <!-- æ§åˆ¶è¯´æ˜ -->
    <div class="controls-panel">
        <strong>ğŸ® é¼ æ ‡æ§åˆ¶:</strong><br>
        â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>
        ğŸ–±ï¸ æ»šè½®æ»šåŠ¨ = ç¼©æ”¾è¿œè¿‘<br>
        ğŸ–±ï¸ å·¦é”®æ‹–æ‹½ = æ—‹è½¬è§†è§’<br>
        ğŸ–±ï¸ ä¸­é”®æ‹–æ‹½ = å¹³ç§»ç”»é¢<br>
    </div>

    <!-- åŠ è½½è¿›åº¦ -->
    <div class="progress-container" id="progressContainer">
        <div class="progress-text" id="progressText">ğŸŒˆ æ­£åœ¨åˆ›å»ºå¡é€šä¸–ç•Œ...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>

    <!-- WebGLç”»å¸ƒ -->
    <canvas id="canvas"></canvas>

    <!-- JavaScriptå¼€å§‹ - è¿™é‡Œæ˜¯WebGLçš„æ ¸å¿ƒé€»è¾‘ -->
    <script>
        // ========== 1. è¿œç¨‹åŠ è½½shaderçš„å·¥å…·å‡½æ•° ==========
        // ç”¨äºé€šè¿‡fetchåŠ è½½è¿œç¨‹shaderæ–‡ä»¶ï¼ˆæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹ï¼‰
        async function loadShader(url) {
            const response = await fetch(url);
            if (!response.ok) throw new Error('æ— æ³•åŠ è½½shader: ' + url);
            const text = await response.text();
            if (!text) throw new Error('shaderå†…å®¹ä¸ºç©º: ' + url);
            return text;
        }

        // ========== 2. WebGLä¸»æµç¨‹ç›¸å…³å…¨å±€å˜é‡ ==========
        let scene, camera, renderer, controls, waterMesh, testObjects = {};

        // ========== 3. è¿›åº¦æ¡ç›¸å…³ ==========
        // è¿›åº¦ç®¡ç† - è·å–HTMLå…ƒç´ å¼•ç”¨
        // document.getElementById() - é€šè¿‡IDè·å–DOMå…ƒç´ 
        // const - å¸¸é‡å£°æ˜ï¼Œè·å–åä¸ä¼šé‡æ–°èµ‹å€¼
        const progressFill = document.getElementById('progressFill');        // è¿›åº¦æ¡å¡«å……å…ƒç´ 
        const progressText = document.getElementById('progressText');        // è¿›åº¦æ–‡å­—å…ƒç´ 
        const progressContainer = document.getElementById('progressContainer');  // è¿›åº¦å®¹å™¨å…ƒç´ 

        // æ›´æ–°è¿›åº¦å‡½æ•° - å‡½æ•°å£°æ˜è¯­æ³•
        function updateProgress(percent, text) {  // æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šè¿›åº¦ç™¾åˆ†æ¯”å’Œæ˜¾ç¤ºæ–‡å­—
            // è®¾ç½®è¿›åº¦æ¡å®½åº¦ - é€šè¿‡CSS styleå±æ€§
            progressFill.style.width = percent + '%';  // å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè®¾ç½®widthæ ·å¼

            // è®¾ç½®è¿›åº¦æ–‡å­— - textContentå±æ€§è®¾ç½®å…ƒç´ æ–‡æœ¬å†…å®¹
            progressText.textContent = text;  // æ›´æ–°æ˜¾ç¤ºçš„è¿›åº¦æ–‡å­—

            // æ¡ä»¶åˆ¤æ–­ - å¦‚æœè¿›åº¦è¾¾åˆ°100%ï¼Œæ‰§è¡Œéšè—åŠ¨ç”»
            if (percent >= 100) {  // >= å¤§äºç­‰äºè¿ç®—ç¬¦
                // setTimeout - å»¶æ—¶æ‰§è¡Œå‡½æ•°ï¼Œ1000æ¯«ç§’ = 1ç§’åæ‰§è¡Œ
                setTimeout(() => {  // ç®­å¤´å‡½æ•°è¯­æ³• (ES6)
                    // è®¾ç½®é€æ˜åº¦ä¸º0ï¼Œå¼€å§‹æ·¡å‡ºåŠ¨ç”»
                    progressContainer.style.opacity = '0';

                    // åµŒå¥—setTimeout - 500æ¯«ç§’åå®Œå…¨éšè—å…ƒç´ 
                    setTimeout(() => {  // å†…å±‚å»¶æ—¶å‡½æ•°
                        progressContainer.style.display = 'none';  // è®¾ç½®displayä¸ºnoneå®Œå…¨éšè—
                    }, 500);  // 500æ¯«ç§’å»¶æ—¶
                }, 1000);  // 1000æ¯«ç§’å»¶æ—¶
            }  // ifè¯­å¥ç»“æŸ
        }  // å‡½æ•°ç»“æŸ

        // ========== 4. åº”ç”¨åˆå§‹åŒ–ä¸»æµç¨‹ ==========
        async function initCartoonWorld() {
            try {
                updateProgress(20, 'ğŸ”§ åˆå§‹åŒ–WebGLæ¸²æŸ“å™¨...');
                await initWebGLRenderer();
                updateProgress(40, 'ğŸŒˆ åˆ›å»ºå¡é€šå¤©ç©º...');
                await createCartoonSkybox();
                updateProgress(60, 'ğŸ’¡ è®¾ç½®å¡é€šå…‰ç…§...');
                setupCartoonLighting();
                updateProgress(80, 'ğŸŒŠ åˆ›å»ºå¡é€šæ°´é¢...');
                createCartoonWater();
                updateProgress(90, 'ğŸª æ·»åŠ æµ‹è¯•ç‰©ä½“...');
                createTestObjects();
                updateProgress(95, 'ğŸ¬ å¯åŠ¨åŠ¨ç”»å¾ªç¯...');
                startRenderLoop();
                updateProgress(100, 'âœ¨ å¡é€šä¸–ç•Œåˆ›å»ºå®Œæˆï¼');
            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);
                updateProgress(0, 'âŒ åˆ›å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°');
            }
        }

        // ========== 5. WebGLæ¸²æŸ“å™¨åˆå§‹åŒ– ==========
        // WebGLæ¸²æŸ“å™¨åˆå§‹åŒ–å‡½æ•° - è¿™æ˜¯WebGLçš„æ ¸å¿ƒè®¾ç½®
        async function initWebGLRenderer() {  // å¼‚æ­¥å‡½æ•°ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…èµ„æºåŠ è½½

            // ğŸ¯ ç¬¬ä¸€æ­¥ï¼šåˆ›å»º3Dåœºæ™¯ (Scene)
            scene = new THREE.Scene();  // THREE.Sceneæ„é€ å‡½æ•°ï¼Œåˆ›å»ºåœºæ™¯å®ä¾‹
            console.log('âœ… 3Dåœºæ™¯åˆ›å»ºæˆåŠŸ - è¿™æ˜¯æ‰€æœ‰3Dç‰©ä½“çš„å®¹å™¨');  // è°ƒè¯•ä¿¡æ¯

            // ğŸ¯ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºé€è§†ç›¸æœº (Perspective Camera => FOV - å®½é«˜æ¯” - è¿‘è£å‰ªè·ç¦» - åŸè£å‰ªè·ç¦»)
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

            // è®¾ç½®ç›¸æœºçš„åˆå§‹ä½ç½® - ä½¿ç”¨3Dåæ ‡ç³»
            camera.position.set(0, 20, 30);  // x=0(å±…ä¸­), y=20(é«˜åº¦), z=30(è·ç¦»åŸç‚¹çš„è¿œè¿‘)

            // è®¾ç½®ç›¸æœºæœå‘ - æŒ‡å®šç›¸æœºçœ‹å‘çš„ç›®æ ‡ç‚¹
            camera.lookAt(0, 0, 0);          // çœ‹å‘ä¸–ç•Œåæ ‡åŸç‚¹(0,0,0)

            // è¾“å‡ºè°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
            console.log('âœ… é€è§†ç›¸æœºåˆ›å»ºæˆåŠŸ - FOV:75Â°, ä½ç½®:(0,20,30)');

            // ğŸ¯ ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºWebGLæ¸²æŸ“å™¨ (WebGL Renderer)
            const canvas = document.getElementById('canvas');
            renderer = new THREE.WebGLRenderer({
                canvas: canvas,                    // æŒ‡å®šæ¸²æŸ“ç›®æ ‡Canvas
                antialias: true,                  // æŠ—é”¯é½¿ - è®©è¾¹ç¼˜æ›´å¹³æ»‘
                alpha: true,                      // æ”¯æŒé€æ˜èƒŒæ™¯
                powerPreference: "high-performance" // ä¼˜å…ˆä½¿ç”¨ç‹¬ç«‹æ˜¾å¡
            });

            // è®¾ç½®æ¸²æŸ“å™¨å°ºå¯¸å’Œåƒç´ å¯†åº¦
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio); // é«˜DPIå±å¹•é€‚é…

            // é…ç½®æ¸²æŸ“è´¨é‡
            renderer.shadowMap.enabled = true;                   // å¯ç”¨é˜´å½±
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;    // è½¯é˜´å½±ç®—æ³•
            renderer.outputEncoding = THREE.sRGBEncoding;        // é¢œè‰²ç©ºé—´æ ¡æ­£
            renderer.toneMapping = THREE.ACESFilmicToneMapping;  // è‰²è°ƒæ˜ å°„
            renderer.toneMappingExposure = 1;                    // æ›å…‰å€¼

            console.log('âœ… WebGLæ¸²æŸ“å™¨åˆ›å»ºæˆåŠŸ - æ”¯æŒé˜´å½±ã€æŠ—é”¯é½¿ã€è‰²è°ƒæ˜ å°„');

            // ğŸ¯ ç¬¬å››æ­¥ï¼šè®¾ç½®äº¤äº’æ§åˆ¶ (Orbit Controls)
            // æ³¨æ„ï¼šOrbitControlséœ€è¦ä»CDNåŠ è½½ï¼Œè¿™é‡Œå…ˆåˆ›å»ºå ä½å‡½æ•°
            setupOrbitControls();
        }

        function setupOrbitControls() {
            // åŠ¨æ€åŠ è½½OrbitControls
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js';
            script.onload = () => {
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;         // å¯ç”¨é˜»å°¼
                controls.dampingFactor = 0.25;         // é˜»å°¼ç³»æ•°
                controls.minDistance = 5;              // æœ€è¿‘è·ç¦»
                controls.maxDistance = 100;            // æœ€è¿œè·ç¦»
                controls.maxPolarAngle = Math.PI / 2.1;  // æœ€å¤§ä»°è§’

                // ğŸ–±ï¸ è‡ªå®šä¹‰é¼ æ ‡æŒ‰é”®æ˜ å°„
                controls.mouseButtons = {
                    LEFT: THREE.MOUSE.ROTATE,    // å·¦é”®ï¼šæ—‹è½¬è§†è§’
                    MIDDLE: THREE.MOUSE.PAN,     // ä¸­é”®ï¼šå¹³ç§»ç”»é¢
                    RIGHT: undefined             // å³é”®ï¼šç¦ç”¨
                };

                console.log('âœ… è½¨é“æ§åˆ¶å™¨åŠ è½½æˆåŠŸ - å·¦é”®æ—‹è½¬ï¼Œä¸­é”®å¹³ç§»ï¼Œå³é”®èœå•ä¿ç•™');
            };
            document.head.appendChild(script);
        }

        // ========== 6. å¤©ç©ºç›’åˆ›å»ºï¼ˆåˆ†æ–‡ä»¶åŠ è½½shaderï¼‰ ==========
        // å…¨å±€å£°æ˜ skyMaterialï¼Œä¾¿äºå…¶å®ƒåœ°æ–¹è®¿é—®å’Œä¿®æ”¹
        let skyMaterial;

        async function createCartoonSkybox() {
            const skyGeometry = new THREE.SphereGeometry(500, 32, 32);
            // åŠ è½½é¡¶ç‚¹å’Œç‰‡å…ƒshader
            const vertexShader = await loadShader('shaders/sky.vert');
            const fragmentShader = await loadShader('shaders/sky.frag');
            // åˆ›å»º ShaderMaterialï¼Œå¹¶èµ‹å€¼ç»™å…¨å±€å˜é‡
            skyMaterial = new THREE.ShaderMaterial({
                vertexShader, fragmentShader,
                uniforms: {
                    topColor: { value: new THREE.Color("#2741A5") },      // é¡¶éƒ¨é¢œè‰²å†™æ­»
                    middleColor: { value: new THREE.Color("#3789E1") },   // å’Œ middleColorPicker ä¸€è‡´
                    bottomColor: { value: new THREE.Color("#ABDEF7") },   // å’Œ bottomColorPicker ä¸€è‡´
                    offset: { value: 33 },
                    exponent: { value: 0.6 },
                    brightness: { value: 0.7 }
                },
                side: THREE.BackSide
            });
            const sky = new THREE.Mesh(skyGeometry, skyMaterial);
            scene.add(sky);
            console.log('âœ… å¡é€šå¤©ç©ºåˆ›å»ºå®Œæˆ - åˆ†æ–‡ä»¶shader');
        }

        // ========== 7. å…¶å®ƒåŠŸèƒ½å‡½æ•°ï¼ˆå…‰ç…§ã€æ°´é¢ã€ç‰©ä½“ã€åŠ¨ç”»ã€å“åº”å¼ç­‰ï¼‰==========
        // åœ¨å…¨å±€å£°æ˜ mainLightï¼Œä¾¿äºåç»­è®¿é—®
        let mainLight;
        // å…¨å±€å­˜å‚¨halfLambertæè´¨ï¼Œä¾¿äºåŠ¨æ€æ›´æ–°uniform
        let halfLambertMaterials = [];

        // ========== ğŸŒŸ å…¨å±€æ˜æš—å˜é‡ ========== 
        // ç”¨äºç»Ÿä¸€ç®¡ç†æ˜æš—æ»‘æ†çš„å€¼ï¼Œæ–¹ä¾¿å…¨å±€è®¿é—®å’ŒåŒæ­¥
        let globalBrightness = 0.7; // åˆå§‹å€¼ä¸æ»‘æ†ä¸€è‡´

        // ========== ğŸŒ‘ å…¨å±€é˜´å½±å˜é‡ ========== 
        // ç”¨äºç»Ÿä¸€ç®¡ç†é˜´å½±æ»‘æ†çš„å€¼ï¼Œæ–¹ä¾¿å…¨å±€è®¿é—®å’ŒåŒæ­¥
        let globalShadow = 0.6; // åˆå§‹å€¼ä¸é˜´å½±æ»‘æ†ä¸€è‡´

        function setupCartoonLighting() {
            // å–é˜³å…‰æ‹¾è‰²å™¨çš„åˆå§‹é¢œè‰²
            const sunColor = document.getElementById('sunColorPicker').value || '#FFE4B5';
            // å–æ˜æš—æ»‘æ†çš„åˆå§‹å€¼ï¼Œèµ‹å€¼ç»™å…¨å±€å˜é‡
            globalBrightness = parseFloat(document.getElementById('brightnessSlider').value) || 0.7;

            // åˆ›å»ºä¸»æ–¹å‘å…‰ï¼Œé¢œè‰²å’Œå¼ºåº¦éƒ½å’ŒUIåŒæ­¥
            mainLight = new THREE.DirectionalLight(
                sunColor,           // é¢œè‰²ï¼šç”¨æ‹¾è‰²å™¨çš„å€¼
                globalBrightness    // å¼ºåº¦ï¼šæ˜æš—æ»‘æ†
            );
            // è®¾ç½®å…‰æºä½ç½® - æ¨¡æ‹Ÿä¸Šåˆé˜³å…‰è§’åº¦
            mainLight.position.set(50, 0, 50);

            // é…ç½®é˜´å½±
            mainLight.castShadow = true; // å¯ç”¨é˜´å½±æŠ•å°„
            // é˜´å½±è´´å›¾åˆ†è¾¨ç‡ï¼ˆé»˜è®¤512x512ï¼Œé€‚ä¸­æ€§èƒ½å’Œæ•ˆæœï¼‰
            mainLight.shadow.mapSize.width = 4096;   // é˜´å½±è´´å›¾å®½åº¦
            mainLight.shadow.mapSize.height = 4096;  // é˜´å½±è´´å›¾é«˜åº¦
            // é˜´å½±ç›¸æœºè¿‘å¹³é¢ï¼ˆé»˜è®¤0.5ï¼Œå†³å®šé˜´å½±èµ·å§‹è·ç¦»ï¼‰
            mainLight.shadow.camera.near = 0.5;     // é˜´å½±ç›¸æœºè¿‘å¹³é¢
            // é˜´å½±ç›¸æœºè¿œå¹³é¢ï¼ˆé»˜è®¤500ï¼Œå†³å®šé˜´å½±æœ€å¤§è·ç¦»ï¼‰
            mainLight.shadow.camera.far = 500;      // é˜´å½±ç›¸æœºè¿œå¹³é¢
            // é˜´å½±ç›¸æœºè§†é”¥ä½“èŒƒå›´ï¼ˆé»˜è®¤-100~100ï¼Œå†³å®šé˜´å½±è¦†ç›–åŒºåŸŸï¼‰
            mainLight.shadow.camera.left = -100;    // å·¦è¾¹ç•Œ
            mainLight.shadow.camera.right = 100;    // å³è¾¹ç•Œ
            mainLight.shadow.camera.top = 100;      // ä¸Šè¾¹ç•Œ
            mainLight.shadow.camera.bottom = -100;  // ä¸‹è¾¹ç•Œ
            // é˜´å½±åç§»ï¼ˆé»˜è®¤0ï¼Œé˜²æ­¢é˜´å½±ä¼ªå½±/æ¼‚æµ®ï¼Œå¯å¾®è°ƒï¼‰
            mainLight.shadow.bias = 0;              // æ·±åº¦åç§»
            mainLight.shadow.normalBias = -0.04;        // æ³•çº¿åç§»

            scene.add(mainLight);
            console.log('âœ… ä¸»æ–¹å‘å…‰è®¾ç½®å®Œæˆ - æ¡ƒè‰²,å¼ºåº¦1.5,æ”¯æŒé˜´å½±');
        }

        // åˆ›å»ºå¡é€šæ°´é¢ï¼Œä½¿ç”¨è‡ªå®šä¹‰Shaderï¼ˆä¸»å…‰+ç¯å¢ƒå…‰+é«˜å…‰+è²æ¶…å°”ï¼‰
        async function createCartoonWater() {
            // åˆ›å»ºæ°´é¢å‡ ä½•ä½“
            const waterGeometry = new THREE.PlaneGeometry(
                200, 200,  // å°ºå¯¸ï¼š200x200å•ä½
                64, 64     // åˆ†æ®µï¼š64x64 (ä¸ºShaderåŠ¨ç”»é¢„ç•™è¶³å¤Ÿé¡¶ç‚¹)
            );

            // åŠ è½½è‡ªå®šä¹‰æ°´é¢shader
            const waterVertex = await loadShader('shaders/cartoonWater.vert');
            const waterFragment = await loadShader('shaders/cartoonWater.frag');

            // è·å–ä¸»å…‰æ–¹å‘ã€ä¸»å…‰é¢œè‰²ã€ç¯å¢ƒå…‰é¢œè‰²
            const lightDir = mainLight ? mainLight.position.clone().normalize() : new THREE.Vector3(1, 2, 1).normalize();
            const lightColor = mainLight ? mainLight.color.clone() : new THREE.Color(document.getElementById('sunColorPicker').value);
            const ambientColor = new THREE.Color(document.getElementById('bottomColorPicker').value);
            // æ°´é¢åŸºç¡€è‰²ï¼ˆå¯è‡ªå®šä¹‰ï¼Œä¹Ÿå¯ç”¨UIè”åŠ¨ï¼‰
            const baseColor = new THREE.Color(0x4ECDC4);

            // åŠ è½½æ³•çº¿è´´å›¾
            const normalMap = new THREE.TextureLoader().load('textures/waterNormal.png');
            normalMap.wrapS = normalMap.wrapT = THREE.RepeatWrapping;

            // åˆ›å»ºShaderMaterial
            const waterMaterial = new THREE.ShaderMaterial({
                uniforms: {
                    lightDirection: { value: lightDir.clone() },
                    lightColor: { value: lightColor.clone() },
                    ambientColor: { value: ambientColor.clone() },
                    baseColor: { value: baseColor.clone() },
                    brightness: { value: globalBrightness },
                    shadow: { value: globalShadow },
                    cameraPosition: { value: camera.position.clone() },
                    normalMap: { value: normalMap },
                    time: { value: 0.0 },
                    repeat: { value: 3.0 },
                    speed: { value: 0.06 },
                    specularThreshold: { value: 0.985 },
                    specularStrength: { value: 0.18 },
                    fresnelPower: { value: 3.0 },
                    fresnelStrength: { value: 0.18 }
                },
                vertexShader: waterVertex,
                fragmentShader: waterFragment,
                transparent: false,
                side: THREE.DoubleSide
            });

            // åˆ›å»ºæ°´é¢ç½‘æ ¼
            waterMesh = new THREE.Mesh(waterGeometry, waterMaterial);
            waterMesh.rotation.x = -Math.PI / 2; // æ—‹è½¬åˆ°æ°´å¹³
            waterMesh.position.y = 0;            // æ°´é¢é«˜åº¦
            waterMesh.receiveShadow = true;      // æ¥æ”¶é˜´å½±

            scene.add(waterMesh);
            console.log('âœ… å¡é€šæ°´é¢åˆ›å»ºå®Œæˆ - è‡ªå®šä¹‰shader');
        }

        // ä½¿ç”¨Half-Lambert Shaderåˆ›å»ºå¡é€šç‰©ä½“
        async function createTestObjects() {
            // åŠ è½½Half-Lambert shaderä»£ç 
            const halfLambertVertex = await loadShader('shaders/halfLambert.vert');
            const halfLambertFragment = await loadShader('shaders/halfLambert.frag');
            console.log('VERT:', halfLambertVertex);
            console.log('FRAG:', halfLambertFragment);

            // è·å–ä¸»å…‰æ–¹å‘å’Œä¸»å…‰é¢œè‰²ï¼ˆä¸–ç•Œç©ºé—´ï¼‰
            const lightDir = mainLight ? mainLight.position.clone().normalize() : new THREE.Vector3(1, 2, 1).normalize();
            const lightColor = mainLight ? mainLight.color.clone() : new THREE.Color(document.getElementById('sunColorPicker').value);
            // ç¯å¢ƒå…‰é¢œè‰²å–è‡ªbottomColorPickerå½“å‰å€¼
            const ambientColor = new THREE.Color(document.getElementById('bottomColorPicker').value);

            // å·¥å…·å‡½æ•°ï¼šåˆ›å»ºHalf-Lambertæè´¨ï¼ˆä¸»å…‰+ç¯å¢ƒå…‰ï¼‰
            function createHalfLambertMaterial(color) {
                const mat = new THREE.ShaderMaterial({
                    uniforms: {
                        lightDirection: { value: lightDir.clone() },
                        lightColor: { value: lightColor.clone() },
                        ambientColor: { value: ambientColor.clone() },
                        baseColor: { value: new THREE.Color(color) },
                        brightness: { value: globalBrightness },
                        shadow: { value: globalShadow },
                    },
                    vertexShader: halfLambertVertex,
                    fragmentShader: halfLambertFragment
                });
                halfLambertMaterials.push(mat);
                return mat;
            }

            // ğŸ§Š å¡é€šç«‹æ–¹ä½“
            const cubeGeometry = new THREE.BoxGeometry(4, 4, 4);
            const cubeMaterial = createHalfLambertMaterial(0xFF6B9D); // ç²‰çº¢è‰²
            const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
            cube.position.set(-10, 0, 0);
            cube.castShadow = true;
            cube.receiveShadow = true;
            scene.add(cube);
            testObjects.cube = cube;

            // ğŸ¾ å¡é€šçƒä½“
            const sphereGeometry = new THREE.SphereGeometry(3, 32, 32);
            const sphereMaterial = createHalfLambertMaterial(0xFFE135); // æ˜é»„è‰²
            const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
            sphere.position.set(10, 0, 0);
            sphere.castShadow = true;
            sphere.receiveShadow = true;
            scene.add(sphere);
            testObjects.sphere = sphere;

            // ğŸ”º å¡é€šåœ†é”¥
            const coneGeometry = new THREE.ConeGeometry(3, 6, 8);
            const coneMaterial = createHalfLambertMaterial(0x95E1D3); // è–„è·ç»¿
            const cone = new THREE.Mesh(coneGeometry, coneMaterial);
            cone.position.set(0, 0, -15);
            cone.castShadow = true;
            cone.receiveShadow = true;
            scene.add(cone);
            testObjects.cone = cone;

            console.log('âœ… æµ‹è¯•ç‰©ä½“åˆ›å»ºå®Œæˆ - Half-Lambert shader');
        }

        function startRenderLoop() {
            const startTime = Date.now();

            function animate() {
                requestAnimationFrame(animate);

                const elapsedTime = (Date.now() - startTime) / 1000;

                // æ›´æ–°åŠ¨ç”»
                updateAnimations(elapsedTime);

                // æ›´æ–°æ§åˆ¶å™¨
                if (controls) controls.update();

                // æ¸²æŸ“åœºæ™¯
                renderer.render(scene, camera);
            }

            animate();
            console.log('âœ… æ¸²æŸ“å¾ªç¯å¯åŠ¨ - 60FPSæŒç»­æ¸²æŸ“');
        }

        function updateAnimations(time) {
            // ç«‹æ–¹ä½“æ—‹è½¬åŠ¨ç”»
            if (testObjects.cube) {
                testObjects.cube.rotation.y = time * 0.2;
                testObjects.cube.rotation.x = Math.sin(time) * 0.2;
            }

            // çƒä½“æµ®åŠ¨åŠ¨ç”»
            if (testObjects.sphere) {
                testObjects.sphere.position.y = Math.sin(time * 2) * 0.4 + 0.2;
                testObjects.sphere.rotation.z = time * 0.3;
            }

            // åœ†é”¥æ‘‡æ‘†åŠ¨ç”»
            if (testObjects.cone) {
                testObjects.cone.rotation.z = Math.sin(time * 1.5) * 0.15;
                testObjects.cone.position.y = Math.cos(time * 0.8) * 0.3 + 1;
            }

        }

        /* ===================== ğŸ“± å“åº”å¼å¤„ç† ===================== */

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        /* ===================== ğŸš€ åº”ç”¨å¯åŠ¨ ===================== */

        // å¯åŠ¨åº”ç”¨
        window.addEventListener('load', async () => {
            await new Promise(resolve => setTimeout(resolve, 500));
            await initCartoonWorld();
        });

        /* ===================== ğŸ› ï¸ è°ƒè¯•å·¥å…· ===================== */

        window.DEBUG = {
            scene, camera, renderer, controls, waterMesh, testObjects,
            info: () => console.log('è°ƒè¯•ä¿¡æ¯:', { scene, camera, renderer }),
            toggleWireframe: () => {
                if (waterMesh) waterMesh.material.wireframe = !waterMesh.material.wireframe;
            }
        };

        console.log('ğŸ› ï¸ è°ƒè¯•å·¥å…·å·²åŠ è½½ - åœ¨æ§åˆ¶å°è¾“å…¥ DEBUG æŸ¥çœ‹å¯ç”¨å‘½ä»¤');

        // ===================== é¢œè‰²å’Œæ˜æš—è°ƒèŠ‚äº‹ä»¶ç›‘å¬ =====================

        // ç›‘å¬å¤©ç©ºåº•éƒ¨é¢œè‰²ï¼Œå®æ—¶æ›´æ–°ç¯å¢ƒå…‰é¢œè‰²
        document.getElementById('bottomColorPicker').addEventListener('input', e => {
            if (skyMaterial) skyMaterial.uniforms.bottomColor.value.set(e.target.value);
            // åŒæ­¥æ‰€æœ‰halfLambertæè´¨çš„ç¯å¢ƒå…‰é¢œè‰²
            const ambColor = new THREE.Color(e.target.value);
            halfLambertMaterials.forEach(mat => {
                if (mat.uniforms.ambientColor) mat.uniforms.ambientColor.value.copy(ambColor);
            });
            updateWaterUniforms();
        });

        // é˜³å…‰é¢œè‰²æ‹¾è‰²å™¨ï¼Œå®æ—¶æ›´æ–° mainLight é¢œè‰²å’Œæ‰€æœ‰halfLambertæè´¨çš„ä¸»å…‰é¢œè‰²
        document.getElementById('sunColorPicker').addEventListener('input', e => {
            if (mainLight) mainLight.color.set(e.target.value);
            // åŒæ­¥æ‰€æœ‰halfLambertæè´¨çš„ä¸»å…‰é¢œè‰²
            const sunColor = new THREE.Color(e.target.value);
            halfLambertMaterials.forEach(mat => {
                if (mat.uniforms.lightColor) mat.uniforms.lightColor.value.copy(sunColor);
            });
            updateWaterUniforms();
        });

        // æ˜æš—æ»‘æ†ï¼Œå®æ—¶æ›´æ–° mainLight å¼ºåº¦å’Œæ‰€æœ‰halfLambertæè´¨æ˜æš—
        document.getElementById('brightnessSlider').addEventListener('input', e => {
            globalBrightness = parseFloat(e.target.value);
            if (mainLight) mainLight.intensity = 1.5 * globalBrightness;
            if (skyMaterial) skyMaterial.uniforms.brightness.value = globalBrightness;
            halfLambertMaterials.forEach(mat => {
                if (mat.uniforms.brightness) mat.uniforms.brightness.value = globalBrightness;
            });
            updateWaterUniforms();
        });

        // é˜´å½±æ»‘æ†ï¼Œå®æ—¶æ›´æ–°æ‰€æœ‰halfLambertæè´¨çš„æš—éƒ¨uniform
        document.getElementById('shadowSlider').addEventListener('input', e => {
            globalShadow = parseFloat(e.target.value);
            halfLambertMaterials.forEach(mat => {
                if (mat.uniforms.shadow) mat.uniforms.shadow.value = globalShadow;
            });
            updateWaterUniforms();
        });

        // ç›‘å¬å¤©ç©ºä¸­é—´é¢œè‰²ï¼Œå®æ—¶æ›´æ–°å¤©ç©ºçƒçš„ä¸­é—´è‰²
        document.getElementById('middleColorPicker').addEventListener('input', e => {
            if (skyMaterial) skyMaterial.uniforms.middleColor.value.set(e.target.value);
        });

        // æ°´é¢shaderè”åŠ¨ï¼šä¸»å…‰ã€ç¯å¢ƒå…‰ã€æ˜æš—ã€é˜´å½±ã€ç›¸æœºå‚æ•°
        function updateWaterUniforms() {
            if (!waterMesh || !waterMesh.material || !waterMesh.material.uniforms) return;
            // ä¸»å…‰
            if (mainLight && waterMesh.material.uniforms.lightDirection)
                waterMesh.material.uniforms.lightDirection.value.copy(mainLight.position.clone().normalize());
            if (mainLight && waterMesh.material.uniforms.lightColor)
                waterMesh.material.uniforms.lightColor.value.copy(mainLight.color);
            // ç¯å¢ƒå…‰
            if (waterMesh.material.uniforms.ambientColor)
                waterMesh.material.uniforms.ambientColor.value.set(document.getElementById('bottomColorPicker').value);
            // æ˜æš—
            if (waterMesh.material.uniforms.brightness)
                waterMesh.material.uniforms.brightness.value = globalBrightness;
            // é˜´å½±
            if (waterMesh.material.uniforms.shadow)
                waterMesh.material.uniforms.shadow.value = globalShadow;
            // ç›¸æœºä½ç½®
            if (waterMesh.material.uniforms.cameraPosition)
                waterMesh.material.uniforms.cameraPosition.value.copy(camera.position);

            // åŒæ­¥æ‰€æœ‰halfLambertæè´¨çš„ä¸»å…‰æ–¹å‘å’Œä¸»å…‰é¢œè‰²
            if (mainLight) {
                const dir = mainLight.position.clone().normalize();
                const color = mainLight.color;
                halfLambertMaterials.forEach(mat => {
                    if (mat.uniforms.lightDirection) mat.uniforms.lightDirection.value.copy(dir);
                    if (mat.uniforms.lightColor) mat.uniforms.lightColor.value.copy(color);
                    if (mat.uniforms.ambientColor) mat.uniforms.ambientColor.value.set(document.getElementById('bottomColorPicker').value);
                    if (mat.uniforms.brightness) mat.uniforms.brightness.value = globalBrightness;
                    if (mat.uniforms.shadow) mat.uniforms.shadow.value = globalShadow;
                });
            }
        }

        // æ¯å¸§æ›´æ–°æ°´é¢shaderçš„ç›¸æœºä½ç½®ï¼ˆä¿è¯è²æ¶…å°”/åå°„æ­£ç¡®ï¼‰
        function updateWaterCameraUniform() {
            if (waterMesh && waterMesh.material && waterMesh.material.uniforms && waterMesh.material.uniforms.cameraPosition) {
                waterMesh.material.uniforms.cameraPosition.value.copy(camera.position);
            }
        }

        // åœ¨æ¸²æŸ“å¾ªç¯é‡Œè°ƒç”¨
        const oldRenderLoop = startRenderLoop;
        startRenderLoop = function () {
            const startTime = Date.now();
            function animate() {
                requestAnimationFrame(animate);
                const elapsedTime = (Date.now() - startTime) / 1000;
                updateAnimations(elapsedTime);
                if (controls) controls.update();
                updateWaterCameraUniform(); // ä¿è¯æ°´é¢è²æ¶…å°”/åå°„å®æ—¶
                if (waterMesh && waterMesh.material && waterMesh.material.uniforms.time) {
                    waterMesh.material.uniforms.time.value = performance.now() * 0.001;
                }
                renderer.render(scene, camera);
            }
            animate();
            console.log('âœ… æ¸²æŸ“å¾ªç¯å¯åŠ¨ - 60FPSæŒç»­æ¸²æŸ“');
        }

        // ç›‘å¬çº¹ç†ç¼©æ”¾æ»‘æ†ï¼Œå®æ—¶åŒæ­¥ repeat
        document.getElementById('waterRepeatSlider').addEventListener('input', e => {
            if (waterMesh && waterMesh.material && waterMesh.material.uniforms.repeat)
                waterMesh.material.uniforms.repeat.value = parseFloat(e.target.value);
        });

        // ç›‘å¬é€Ÿåº¦æ»‘æ†ï¼Œå®æ—¶åŒæ­¥ speed
        document.getElementById('waterSpeedSlider').addEventListener('input', e => {
            if (waterMesh && waterMesh.material && waterMesh.material.uniforms.speed)
                waterMesh.material.uniforms.speed.value = parseFloat(e.target.value);
        });

        // ç­‰å¾…DOMåŠ è½½å®Œæˆåå†æ·»åŠ äº‹ä»¶ç›‘å¬ï¼Œé¿å…æ‰¾ä¸åˆ°å…ƒç´ 
        window.addEventListener('DOMContentLoaded', function() {
            // é«˜å…‰é˜ˆå€¼æ»‘å—
            document.getElementById('waterSpecularThresholdSlider').addEventListener('input', e => {
                // å®æ—¶æ˜¾ç¤ºå½“å‰å€¼
                document.getElementById('waterSpecularThresholdValue').textContent = e.target.value;
                // æ›´æ–°æ°´é¢æè´¨çš„é«˜å…‰é˜ˆå€¼
                if (waterMesh && waterMesh.material && waterMesh.material.uniforms.specularThreshold)
                    waterMesh.material.uniforms.specularThreshold.value = parseFloat(e.target.value);
            });

            // é«˜å…‰å¼ºåº¦æ»‘å—
            document.getElementById('waterSpecularStrengthSlider').addEventListener('input', e => {
                document.getElementById('waterSpecularStrengthValue').textContent = e.target.value;
                if (waterMesh && waterMesh.material && waterMesh.material.uniforms.specularStrength)
                    waterMesh.material.uniforms.specularStrength.value = parseFloat(e.target.value);
            });

            // è²å°¼å°”Poweræ»‘å—
            document.getElementById('waterFresnelPowerSlider').addEventListener('input', e => {
                document.getElementById('waterFresnelPowerValue').textContent = e.target.value;
                if (waterMesh && waterMesh.material && waterMesh.material.uniforms.fresnelPower)
                    waterMesh.material.uniforms.fresnelPower.value = parseFloat(e.target.value);
            });

            // è²å°¼å°”å¼ºåº¦æ»‘å—
            document.getElementById('waterFresnelStrengthSlider').addEventListener('input', e => {
                document.getElementById('waterFresnelStrengthValue').textContent = e.target.value;
                if (waterMesh && waterMesh.material && waterMesh.material.uniforms.fresnelStrength)
                    waterMesh.material.uniforms.fresnelStrength.value = parseFloat(e.target.value);
            });

            // ===================== â˜€ï¸ é˜³å…‰æ–¹å‘æ»‘å—äº‹ä»¶ç›‘å¬ =====================
            // è¯´æ˜ï¼šé€šè¿‡ä¸¤ä¸ªè§’åº¦æ»‘å—å®æ—¶è°ƒæ•´ä¸»å…‰ï¼ˆDirectionalLightï¼‰æ–¹å‘
            // è·å–Xè½´å’ŒZè½´è§’åº¦æ»‘å—åŠæ˜¾ç¤ºå€¼
            const sunDirXSlider = document.getElementById('sunDirXSlider');
            const sunDirZSlider = document.getElementById('sunDirZSlider');
            const sunDirXValue = document.getElementById('sunDirXValue');
            const sunDirZValue = document.getElementById('sunDirZValue');

            // å·¥å…·å‡½æ•°ï¼šæ ¹æ®Xã€Zè§’åº¦è®¾ç½®ä¸»å…‰æ–¹å‘
            function updateMainLightDirection() {
                // è¯»å–æ»‘å—è§’åº¦å€¼ï¼ˆå•ä½ï¼šåº¦ï¼‰
                const xDeg = parseFloat(sunDirXSlider.value);
                const zDeg = parseFloat(sunDirZSlider.value);
                // æ˜¾ç¤ºå½“å‰è§’åº¦
                sunDirXValue.textContent = xDeg;
                sunDirZValue.textContent = zDeg;
                // è½¬ä¸ºå¼§åº¦
                const xRad = xDeg * Math.PI / 180;
                const zRad = zDeg * Math.PI / 180;
                // è®¡ç®—æ–¹å‘å‘é‡ï¼ˆYè½´å§‹ç»ˆå‘ä¸‹ï¼ŒXå’ŒZç”±è§’åº¦æ§åˆ¶ï¼‰
                // åŠçƒåæ ‡ç³»ï¼Œr=1
                const r = 1;
                const y = Math.sin(xRad); // Xè½´è§’åº¦æ§åˆ¶ä»°ä¿¯
                const x = Math.cos(xRad) * Math.sin(zRad); // Zè½´è§’åº¦æ§åˆ¶æ–¹ä½
                const z = Math.cos(xRad) * Math.cos(zRad);
                // è®¾ç½®ä¸»å…‰ä½ç½®ï¼ˆæ–¹å‘ï¼‰
                if (mainLight) {
                    mainLight.position.set(x * 50, y * 50, z * 50);
                    updateWaterUniforms(); // åªè°ƒç”¨ä¸€æ¬¡ç»Ÿä¸€åŒæ­¥
                }
            }

            // ç›‘å¬æ»‘å—å˜åŒ–
            sunDirXSlider.addEventListener('input', updateMainLightDirection);
            sunDirZSlider.addEventListener('input', updateMainLightDirection);

            // åˆå§‹åŒ–ä¸€æ¬¡
            updateMainLightDirection();
        });

    </script>
</body>

</html>